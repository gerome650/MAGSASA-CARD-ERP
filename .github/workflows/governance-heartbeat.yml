name: 🫀 Governance Heartbeat

on:
  schedule:
    - cron: "0 12 1 */3 *"   # Every 3 months on the 1st day at 12:00 UTC
  workflow_dispatch:

jobs:
  heartbeat:
    runs-on: ubuntu-latest
    steps:
      - name: 🧠 Create or Update Governance Heartbeat Issue
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { owner, repo } = context.repo;
            const issueTitle = "🫀 Governance Heartbeat — Review Required";
            const body = `
            ## 🧭 Governance Review Checklist

            This is your scheduled governance heartbeat reminder.  
            Please review and verify that the following **governance anchors** remain accurate, enforced, and in sync:

            - [ ] SYSTEM_PROMPT.md
            - [ ] .github/GOVERNANCE_BRANCH_PROTECTION_CHECKLIST.md
            - [ ] .github/CODEOWNERS
            - [ ] .github/PULL_REQUEST_TEMPLATE.md
            - [ ] .github/workflows/pr-governance-check.yml
            - [ ] specs/observer_guardrails.yaml
            - [ ] specs/render_integration.md
            - [ ] specs/slack_integration.md
            - [ ] specs/mcp-architecture.md

            🧑‍⚖️ Governance Team:
            - @gerome650
            - @pepoy-songco
            - @lia-anonas

            📅 Next heartbeat will auto-trigger in 90 days.
            `;
            
            const { data: issues } = await github.rest.issues.listForRepo({
              owner,
              repo,
              state: "open",
              labels: "governance,heartbeat"
            });

            const existing = issues.find(issue => issue.title === issueTitle);

            if (existing) {
              await github.rest.issues.update({
                owner,
                repo,
                issue_number: existing.number,
                body,
              });
              core.info(`✅ Updated existing heartbeat issue #${existing.number}`);
            } else {
              const { data: newIssue } = await github.rest.issues.create({
                owner,
                repo,
                title: issueTitle,
                body,
                labels: ["governance", "heartbeat"]
              });
              core.info(`🆕 Created new heartbeat issue #${newIssue.number}`);
            }

